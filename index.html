<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —à–∫–æ–ª—ã 1430</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <button class="menu-toggle" id="menuToggle" aria-label="–ú–µ–Ω—é">
                <span class="hamburger"></span>
            </button>
            <div class="header-logo">
                <span class="school-logo">üè´</span>
                <h1 class="header-title">–®–∫–æ–ª–∞ ‚Ññ 1430 - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞</h1>
            </div>
            <div class="floor-controls">
                <div class="floor-selector">
                    <div class="floor-with-delete">
                        <button class="floor-btn active" data-floor="1">–≠—Ç–∞–∂ 1</button>
                        <button class="floor-delete-btn" data-floor="1" title="–£–¥–∞–ª–∏—Ç—å —ç—Ç–∞–∂" style="display: none;">√ó</button>
                    </div>
                    <div class="floor-with-delete">
                        <button class="floor-btn" data-floor="2">–≠—Ç–∞–∂ 2</button>
                        <button class="floor-delete-btn" data-floor="2" title="–£–¥–∞–ª–∏—Ç—å —ç—Ç–∞–∂">√ó</button>
                    </div>
                    <div class="floor-with-delete">
                        <button class="floor-btn" data-floor="3">–≠—Ç–∞–∂ 3</button>
                        <button class="floor-delete-btn" data-floor="3" title="–£–¥–∞–ª–∏—Ç—å —ç—Ç–∞–∂">√ó</button>
                    </div>
                    <button class="floor-btn add-floor" id="addFloor">+</button>
                </div>
                <div class="current-floor-indicator">
                    <span id="currentFloorText">–≠—Ç–∞–∂ 1</span>
                </div>
            </div>
            <button class="theme-toggle" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                <span class="theme-icon">‚òÄÔ∏è</span>
            </button>
        </div>
    </header>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <!-- Mode Selection -->
                <div class="control-group">
                    <h3>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</h3>
                    <div class="mode-buttons">
                        <button class="btn btn--sm mode-btn active" data-mode="pan">üñêÔ∏è –ü–∞–Ω–æ—Ä–∞–º–∞</button>
                        <button class="btn btn--sm mode-btn" data-mode="add">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                        <button class="btn btn--sm mode-btn" data-mode="edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn--sm mode-btn" data-mode="connect">üîó –°–æ–µ–¥–∏–Ω–∏—Ç—å</button>
                        <button class="btn btn--sm mode-btn" data-mode="delete">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>

                <!-- Node Types -->
                <div class="control-group">
                    <h3>–¢–∏–ø —É–∑–ª–∞</h3>
                    <div class="node-type-buttons">
                        <button class="btn btn--sm node-type-btn active" data-type="room">
                            <span class="node-preview room"></span>
                            –ö–æ–º–Ω–∞—Ç–∞
                        </button>
                        <button class="btn btn--sm node-type-btn" data-type="stair">
                            <span class="node-preview stair"></span>
                            –õ–µ—Å—Ç–Ω–∏—Ü–∞
                        </button>
                        <button class="btn btn--sm node-type-btn" data-type="corridor">
                            <span class="node-preview corridor"></span>
                            –ö–æ—Ä–∏–¥–æ—Ä
                        </button>
                        <button class="btn btn--sm node-type-btn" data-type="exit">
                            <span class="node-preview exit"></span>
                            –í—ã—Ö–æ–¥
                        </button>
                    </div>
                </div>

                <!-- Zoom Controls -->
                <div class="control-group">
                    <h3>–ú–∞—Å—à—Ç–∞–±</h3>
                    <div class="zoom-controls">
                        <button class="btn btn--sm" id="zoomIn">üîç+ –ü—Ä–∏–±–ª–∏–∑–∏—Ç—å</button>
                        <button class="btn btn--sm" id="zoomOut">üîç- –û—Ç–¥–∞–ª–∏—Ç—å</button>
                        <button class="btn btn--sm" id="resetView">üéØ –°–±—Ä–æ—Å–∏—Ç—å</button>
                    </div>
                </div>

                <!-- QR Scanner -->
                <div class="control-group">
                    <h3>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h3>
                    <button class="btn btn--primary" id="scanQR">üì∑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR</button>
                    <div class="current-location" id="currentLocation" style="display: none;">
                        <span class="status status--info">üìç –í—ã –∑–¥–µ—Å—å: <span id="locationText"></span></span>
                    </div>
                </div>

                <!-- Route Planning -->
                <div class="control-group">
                    <h3>–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞</h3>
                    <div class="route-controls">
                        <div class="form-group">
                            <label class="form-label" for="startPoint">–û—Ç–∫—É–¥–∞:</label>
                            <select class="form-control" id="startPoint">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="endPoint">–ö—É–¥–∞:</label>
                            <select class="form-control" id="endPoint">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–µ—á–Ω—É—é —Ç–æ—á–∫—É</option>
                            </select>
                        </div>
                        <button class="btn btn--primary btn--full-width" id="buildRoute">üó∫Ô∏è –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
                        <button class="btn btn--outline btn--full-width" id="clearRoute">‚ùå –û—á–∏—Å—Ç–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
                    </div>
                </div>

                <!-- Voice Navigation -->
                <div class="control-group voice-nav-group" id="voiceNavGroup" style="display: none;">
                    <h3>–ì–æ–ª–æ—Å–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è</h3>
                    <div class="voice-controls">
                        <button class="btn btn--primary" id="startVoiceNav">üîä –ù–∞—á–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é</button>
                        <button class="btn btn--outline" id="stopVoiceNav" style="display: none;">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                        <div class="voice-step-controls" id="voiceStepControls" style="display: none;">
                            <button class="btn btn--sm" id="prevStep">‚¨ÖÔ∏è –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
                            <button class="btn btn--sm" id="nextStep">‚û°Ô∏è –°–ª–µ–¥—É—é—â–∞—è</button>
                        </div>
                        <div class="current-instruction" id="currentInstruction"></div>
                    </div>
                </div>

                <!-- Map Management -->
                <div class="control-group">
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ–π</h3>
                    <div class="map-management">
                        <button class="btn btn--outline btn--full-width" id="saveMap">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                        <input type="file" id="loadMapInput" accept=".json" style="display: none;">
                        <button class="btn btn--outline btn--full-width" id="loadMap">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É</button>
                        <button class="btn btn--outline btn--full-width" id="clearAll">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="canvas-container" id="canvasContainer">
                <canvas id="mapCanvas"></canvas>
                
                <!-- Floating Controls (Mobile) -->
                <div class="floating-controls">
                    <button class="floating-btn" id="floatingZoomIn" title="–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å">üîç+</button>
                    <button class="floating-btn" id="floatingZoomOut" title="–û—Ç–¥–∞–ª–∏—Ç—å">üîç-</button>
                </div>
            </div>
        </main>
    </div>

    <!-- QR Scanner Modal -->
    <div class="modal" id="qrModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞</h2>
                <button class="modal-close" id="closeQR">&times;</button>
            </div>
            <div class="modal-body">
                <div id="qr-reader" class="qr-reader"></div>
                <div class="qr-instructions">
                    <p>–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Node Editor Modal -->
    <div class="modal" id="nodeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∑–ª–∞</h2>
                <button class="modal-close" id="closeNodeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="nodeForm">
                    <div class="form-group">
                        <label class="form-label" for="nodeName">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                        <input type="text" class="form-control" id="nodeName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="nodeInfo">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <textarea class="form-control" id="nodeInfo" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="nodeQR">QR-–∫–æ–¥ ID:</label>
                        <input type="text" class="form-control" id="nodeQR">
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn--primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="button" class="btn btn--outline" id="cancelNodeEdit">‚ùå –û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Floor Delete Confirmation Modal -->
    <div class="modal" id="deleteFloorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–£–¥–∞–ª–µ–Ω–∏–µ —ç—Ç–∞–∂–∞</h2>
                <button class="modal-close" id="closeDeleteFloorModal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="deleteFloorText">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≠—Ç–∞–∂ X? –í—Å–µ —É–∑–ª—ã –∏ —Å–≤—è–∑–∏ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.</p>
                <div class="modal-actions">
                    <button class="btn btn--primary btn-delete" id="confirmDeleteFloor">–î–∞, —É–¥–∞–ª–∏—Ç—å</button>
                    <button class="btn btn--outline" id="cancelDeleteFloor">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script src="app.js"></script>
</body>
</html>